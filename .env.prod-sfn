# RustDesk Server Configuration - PRODUCTION SFN SÉCURISÉ
# Environnement 3 : SFN (Réseau sécurisé, canalisé)
# ~2000 machines
# IMPORTANT: Firewall strict - UNIQUEMENT ports 21115-21119

# ============================================================================
# INFORMATIONS RÉSEAU
# ============================================================================

# Domaine du serveur (DNS interne SFN)
SERVER_DOMAIN=rustdesk-sfn.bh-systems.be

# IP du serveur ID/Rendezvous (hbbs)
HBBS_IP=172.30.0.100

# IP du serveur Relay (hbbr) - séparé pour sécurité
HBBR_PRIMARY_IP=172.30.0.101

# Relay Server
RELAY_SERVER=rustdesk-hbbr-sfn

# Subnet Docker (unique pour SFN)
DOCKER_SUBNET=172.23.0.0/24

# ============================================================================
# SÉCURITÉ RENFORCÉE (SFN)
# ============================================================================

# Clés secrètes - UTILISEZ DES VALEURS DIFFÉRENTES D'OFFICE ET MCN !
# Générer avec: openssl rand -base64 32
POSTGRES_PASSWORD=CHANGE_ME_SFN_DB_PASSWORD_$(openssl rand -base64 16)
DB_URL=postgresql://rustdesk_admin:CHANGE_ME_SFN_DB_PASSWORD@postgres:5432/rustdesk_sfn

# Clés API (uniques pour SFN)
API_SECRET_KEY=CHANGE_ME_SFN_API_SECRET_$(openssl rand -base64 32)
SESSION_SECRET=CHANGE_ME_SFN_SESSION_SECRET_$(openssl rand -base64 32)

# Active Directory / LDAP - Domaine SFN séparé
LDAP_ENABLED=true
LDAP_SERVER=ldap://ad-sfn.bh-systems.be:389
LDAP_BASE_DN=DC=sfn,DC=bh-systems,DC=be
LDAP_BIND_DN=CN=RustDesk Service SFN,OU=Service Accounts,DC=sfn,DC=bh-systems,DC=be
LDAP_BIND_PASSWORD=CHANGE_ME_LDAP_PASSWORD_SFN
LDAP_USER_FILTER=(objectClass=user)
LDAP_GROUP_FILTER=(objectClass=group)

# Restriction d'accès (groupes AD autorisés)
LDAP_ALLOWED_GROUPS=CN=SFN-Admins,OU=Groups,DC=sfn,DC=bh-systems,DC=be

# ============================================================================
# SSL/TLS Configuration
# ============================================================================

SSL_CERT_PATH=./certs/sfn/fullchain.pem
SSL_KEY_PATH=./certs/sfn/privkey.pem

# Forcer TLS 1.3 uniquement pour sécurité maximale
SSL_MIN_VERSION=TLSv1.3

# ============================================================================
# EMAIL (Notifications SFN)
# ============================================================================

SMTP_HOST=smtp.sfn.bh-systems.be
SMTP_PORT=587
SMTP_USER=rustdesk-sfn@bh-systems.be
SMTP_PASSWORD=CHANGE_ME_SMTP_PASSWORD_SFN
SMTP_FROM=rustdesk-sfn@bh-systems.be

# ============================================================================
# PERFORMANCE (SFN ~2000 machines)
# ============================================================================

POSTGRES_DB=rustdesk_sfn
POSTGRES_USER=rustdesk_admin_sfn

MAX_CONNECTIONS=3000
WORKER_PROCESSES=4

# Logging détaillé pour audit
LOG_LEVEL=info
AUDIT_LOG_ENABLED=true
AUDIT_LOG_PATH=/var/log/rustdesk/audit-sfn.log

# ============================================================================
# FIREWALL - RÈGLES STRICTES
# ============================================================================
# AUTORISÉ:
#   21115 - hbbs TCP (NAT type test)
#   21116 - hbbs TCP/UDP (ID registration)
#   21117 - hbbr TCP (Relay)
#   21118 - hbbs TCP (Web socket)
#   21119 - hbbr TCP (Web socket)
#
# TOUT LE RESTE BLOQUÉ !
